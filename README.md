# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Проект реализован с помощью архитектуры MVP (Model-View-Presenter)

Слой представления, отвечает за отображение данных на странице.

Слой данных, отвечает за хранение и изменение данных.

Презентер, отвечает за связь представления и данных.

## Слой данных

### Класс AppState
Класс для отслеживания состояния данных всего приложения

Поля:
- `catalog: IProduct[]` - отслеживание списка доступных товаров
- `preview: string | null` - отслеживает товар который в данных момент взаимодействуется в модальном окне
- `basket: IProduct[]` - отслеживание товаров которые есть в корзине
- `order: IOrder | null` - отслеживание состояния заказа


### Класс Product
Класс представляет конкретный продукт в магазине..

Поля:
- `id:string;` - id товара
- `description:string;` - описание товара
- `name:string;` - название товара
- `category:string;` - категория товара
- `price:number|null;` - цена товара
- `image:string;` - картинка товара


## Слой представления
Все классы представления отвечают за отображения внутри контейнера (DOM-элемент) передаваемых в них данных.

### Класс Page
Класс для отображения страницы и отоброжением ее состояния в приложении

`constructor(container: HTMLElement, events: IEvents)` - конструктор принимает элемент контейнера и объект для управления событиями

Поля:
- `basket:HTMLElement` кол-во товаров в корзине
- `catalog:HTMLElement[]` - массив карточек товаров на странице
- `_wrapper:HTMLElement` - обертка страницы которая будет блокировать прокрутку страницы
- `_basket:HTMLElement` - кнопка которая будет открывать корзину 

методы:
- `set basket` - устанавливает значение кол-ва товаров в корзине
- `set catalog` - устаавливает список товаров магазина на странице


### Класс Modal

Реализует модальное окно. Наследует базовый класс Component.\
Обладает методом для установки переданного контента, методами `open` и `close`, а также отображением контента. Устанавливает слушатели на клавиутару, для закрытия модального окна по Esc, на клик в оверлей и на кнопку-крестик для закрытия модального окна.

`constructor(container: HTMLElement, events: IEvents)` - конструктор принимает элемент контейнера и объект для управления событиями.

Поля класса 
- `modal: HTMKLElement` - элемент модального окна
- `events: IEvents`- брокер событий

### Класс Form
Данный класс для отображения форм и взаимодействия с ними.\

Поля:
- `_submit: HTMLButtonElement` - кнопка отправки формы
- `_errors: HTMLElement`- отображение ошибок формы


`constructor(container: HTMLFormElement, events: IEvents)` - конструктор принимает элемент формы и устанавливает обработчиков событий для вода данных и отправки.

методы:
- `set valid` - устанавливает состояние доступности кнопки отправки в зависимости от валидности формы
- `set errors` - устанавливает текст ошибок формы
- `render` - рендер компонента формы с учетом переданного состояния


### Класс PaymentForm
Расширяет класс Form. Реализует обработку выбора способа оплаты  и адреса доставки.

Методы:

- `set payment` - устанавливает способ оплаты
- `set address` - устанавливает адрес доставки 

### Класс ContactForm

Расширяет класс Form. Реализует получение контактной информации с пользователя, а именно его почта и номер телефона.

Методы:

- `set email` - устанавливает почту в форме
- `set phone` - устанавливает телефон в форме


### Класс Basket

Класс отображает содержимое корзины и  содержит методы для управления этим содержимым.

`constructor(container: HTMLElement, events: IEvents)` - принимает элемент контейнера и действие над элементом корзины

Поля:
- `_items: HTMLElement` - список товаров в корзине
- `_total: HTMLElement` - общая стоимость товаров в корзине
- `_button: HTMLElement` - Кнопка для оформления заказа(дальнейший переход IPaymentForm)

Методы: 
- `set items` - устанавливает список выбранных товаров пользователем в корзине
- `set total` - устанавиливает общую стоимость всех товаров в корзине


### Класс Card

Класс карточки товара и отображения ее данных

Поля:
- `id:HTMLElement;` - id товара
- `description:HTMLElement;` - описание товара
- `name:HTMLElement;` - название товара
- `category:HTMLElement;` - категория товара
- `price:HTMLElement;` - цена товара
- `image:HTMLImageElement;` - картинка товара
- `_button: HTMLElement` - слушатель кнопки карточки


## Базовый код

### Класс Api
Базовый класс отвечающий за работу с сервером

Конструктор класса:
- `constructor(baseUrl, options)`: Конструктор класса, принимающий базовый URL и дополнительные параметры запроса.

Методы:
   - `handleResponse(response)`: Метод для обработки ответа от сервера. Если ответ успешен, возвращает JSON-данные. В противном случае возвращает ошибку или текст ошибки.
   - `get(uri)`: выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
   - `post(uri, data, method)`: принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Класс `EventEmitter` содержит методы для управления событиями:
- `on`: устанавливает обработчик на определенное событие.
- `off`: снимает обработчик с события.
- `emit`: инициирует событие с данными.
- `onAll`: позволяет подписаться на все события.
- `offAll`: сбрасывает все обработчики.
- `trigger`: создает коллбек-триггер, который генерирует событие при вызове.

### Класс Model
Абстрактный класс служит в качестве основной модели, на основе которой создаются другие модели в приложении.Наследуется классами Model.

Конструктор класса:\
`constructor(data: Partial<T>, protected events: IEvents)` - принимает данные и событие

Методы:

- `emitChanges` - cообщает всем заинтересованным сторонам о изменениях в модели.

### Класс Component
Абстрактный класс служащий для создания компонентов пользовательского интерфейса. Наследуется классами View.

Конструктор класса:

`constructor(container: HTMLElement)` - принимает элемент контейнера в который будет помещен нужный компонент

Методы:

- `toggleClass` - переключает класс для переданного элемента
- `setText` - устанавливает текстовое содержимое для переданного элемента
- `setImage` - устанавливает изображения и альтернативный текст изоображения
- `setDisabled` - изменяет статус блокировки для переданного компонент
- `setVisible` - отоброжает компонент
- `setHidden` - скрывает компонент
- `render` - рендерит компонент



## События

*Список событий которые могут генерироваться в системе:*
- `catalog:changed` - изменение массива карточек
(помимо каталога больше никакие данные не изменяются)


*События, возникающие при взаимодействии пользователя с интерфейсом:*
- `card:open `- открытие карточки из списка товаров
- `basket:open` - открытие карзины
- `basket:deleteItem`- удаление из списка выбранных товаров в корзине по кнопке
- `modal:open` - открытие модального окна 
- `modal:close` - закрытие модального окна
- `order:open` - открытие формы с выбором способа оплаты и введением адреса
- `order:input` - ввод данных в форме order
- `order:submit` - подтверждение адреса и способа оплаты -> открытие формы contacts
- `order:validation`- валидация адреса доставки
- `contacts:submit` -  подтверждение формы с контактными данными пользователя -> открытие модального окна
- `contacts:input` - ввод данных в форме контактных данных
- `contacts:validation` - валидация контактных данных пользователя(номера телефона и почты)
## Типы данных

```
//интерфейс карточки товара
export interface IProduct{
 id:string;
 description:string;
 name:string;
 category:string;
 price:number|null;
 image:string;
}

// интерфейс страницы
export interface IPage{
  basket:number;
  catalog:HTMLElement[];
}

//интерфейс формы доставки 
export interface IPaymentForm{
  payment: string;
  address: string;
}

//интерфейс формы контактов покупателя
export interface IContactForm{
  email: string;
  phone: string;
}

// интерфейс глобального состояния приложения
export interface IAppState {
  catalog: IProduct[];
  preview: string | null;
  basket: IProduct[];
  order: IOrder | null;
}

//интерфейс заказа
export interface IOrder extends IPaymentForm,IContactForm{
  total: number;
  items: string[];
}

//интерфейс удачной покупки 
export interface ISuccessfulPurchase{
  id:string;
  total:number;
}

// интерфейс модального окна
export interface IModalUI {
  content: HTMLElement;
}

// интерфейс корзины
export interface IBasket{
  items: HTMLElement[];
  total: number;
}
```

